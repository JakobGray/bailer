

AWK_COMMAND='
{
    if (oc_client_version ~ /4.6/ ){
        if (NF==5) {            # if all 5 columns have values...
            print $1"."$3       # skip short name, concat name and api group
        } 
        else if ($2 ~ /\./) {   # if shortname missing (only apigroup has period(s))
            print $1"."$2       # concat name and api group
        } 
        else {
            print $1            # api group missing, just print name 
        }
    }
    else { 

        # 4.7 or newer 
        # In 4.7, column APIGROUP replaced with APIVERSION
        # APIVERSION appears to be APIGROUP/VERSION (or just VERSION if APIGROUP undef)
        # APIVERSION also appears to be always defined
        # Must remove VERSION from APIGROUP for script to work

        if (NF==5) {                # if all 5 columns have values...
            if ($3 ~ /\//){         # and if APIVERSION contains APIGROUP
                split($3, a, "/")   # remove version
                print $1"."a[1]     # and concat name and api group
            }
            else{                   # but if APIVERSION only contains VERSION
                print $1            # just print name
            }
        } 
        else if ($2 ~ /\./) {       # if shortname missing (only apigroup has period(s))
            if ($2 ~ /\//){         # and if APIVERSION contains APIGROUP
                split($2, a, "/")   # remove version
                print $1"."a[1]     # and concat name and api group
            }
            else{                   # but if APIVERSION only contains VERSION
                print $1            # just print name
            }
        } 
        else {
            print $1
        }
    }
}
'

OC_CLIENT_VERSION=$(oc version --client | tr -s " " | awk '{split($3, a, "-"); print a[1]}')

oc api-resources --verbs=list | tr -s " " | awk -v oc_client_version=$OC_CLIENT_VERSION "$AWK_COMMAND" > all-resources-4.7

OC_BACKUP_CLIENT_VERSION=$(oc-backup version --client | tr -s " " | awk '{split($3, a, "-"); print a[1]}')

oc-backup api-resources --verbs=list | tr -s " " | awk -v oc_client_version=$OC_BACKUP_CLIENT_VERSION  "$AWK_COMMAND" > all-resources-4.6